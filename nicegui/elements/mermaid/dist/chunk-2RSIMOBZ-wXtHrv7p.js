import{_ as t}from"./chunk-UWHJNN4Q-DrnYEre_.js";import{m as r,J as a,ax as e,g as i,h as s,Q as n,an as d,ao as l,f as o,am as p,I as h}from"./index-Dne072Ek.js";var c=r((t,r,a,e)=>{r.forEach(r=>{g[r](t,a,e)})},"insertMarkers"),g={extension:r((t,r,e)=>{a.trace("Making markers for ",e),t.append("defs").append("marker").attr("id",e+"_"+r+"-extensionStart").attr("class","marker extension "+r).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),t.append("defs").append("marker").attr("id",e+"_"+r+"-extensionEnd").attr("class","marker extension "+r).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z")},"extension"),composition:r((t,r,a)=>{t.append("defs").append("marker").attr("id",a+"_"+r+"-compositionStart").attr("class","marker composition "+r).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id",a+"_"+r+"-compositionEnd").attr("class","marker composition "+r).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},"composition"),aggregation:r((t,r,a)=>{t.append("defs").append("marker").attr("id",a+"_"+r+"-aggregationStart").attr("class","marker aggregation "+r).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id",a+"_"+r+"-aggregationEnd").attr("class","marker aggregation "+r).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},"aggregation"),dependency:r((t,r,a)=>{t.append("defs").append("marker").attr("id",a+"_"+r+"-dependencyStart").attr("class","marker dependency "+r).attr("refX",6).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id",a+"_"+r+"-dependencyEnd").attr("class","marker dependency "+r).attr("refX",13).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},"dependency"),lollipop:r((t,r,a)=>{t.append("defs").append("marker").attr("id",a+"_"+r+"-lollipopStart").attr("class","marker lollipop "+r).attr("refX",13).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","transparent").attr("cx",7).attr("cy",7).attr("r",6),t.append("defs").append("marker").attr("id",a+"_"+r+"-lollipopEnd").attr("class","marker lollipop "+r).attr("refX",1).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","transparent").attr("cx",7).attr("cy",7).attr("r",6)},"lollipop"),point:r((t,r,a)=>{t.append("marker").attr("id",a+"_"+r+"-pointEnd").attr("class","marker "+r).attr("viewBox","0 0 10 10").attr("refX",6).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),t.append("marker").attr("id",a+"_"+r+"-pointStart").attr("class","marker "+r).attr("viewBox","0 0 10 10").attr("refX",4.5).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto").append("path").attr("d","M 0 5 L 10 10 L 10 0 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},"point"),circle:r((t,r,a)=>{t.append("marker").attr("id",a+"_"+r+"-circleEnd").attr("class","marker "+r).attr("viewBox","0 0 10 10").attr("refX",11).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),t.append("marker").attr("id",a+"_"+r+"-circleStart").attr("class","marker "+r).attr("viewBox","0 0 10 10").attr("refX",-1).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},"circle"),cross:r((t,r,a)=>{t.append("marker").attr("id",a+"_"+r+"-crossEnd").attr("class","marker cross "+r).attr("viewBox","0 0 11 11").attr("refX",12).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0"),t.append("marker").attr("id",a+"_"+r+"-crossStart").attr("class","marker cross "+r).attr("viewBox","0 0 11 11").attr("refX",-1).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0")},"cross"),barb:r((t,r,a)=>{t.append("defs").append("marker").attr("id",a+"_"+r+"-barbEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",14).attr("markerUnits","strokeWidth").attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"barb")},m=c,k=r((t,r,a,e,i)=>{r.arrowTypeStart&&y(t,"start",r.arrowTypeStart,a,e,i),r.arrowTypeEnd&&y(t,"end",r.arrowTypeEnd,a,e,i)},"addEdgeMarkers"),f={arrow_cross:"cross",arrow_point:"point",arrow_barb:"barb",arrow_circle:"circle",aggregation:"aggregation",extension:"extension",composition:"composition",dependency:"dependency",lollipop:"lollipop"},y=r((t,r,e,i,s,n)=>{let d=f[e];if(!d)return void a.warn(`Unknown arrow type: ${e}`);let l="start"===r?"Start":"End";t.attr(`marker-${r}`,`url(${i}#${s}_${n}-${d}${l})`)},"addEdgeMarker"),b={},x={},u=r(()=>{b={},x={}},"clear"),L=r((r,a)=>{let e=n(),i=d(e.flowchart.htmlLabels),s="markdown"===a.labelType?l(r,a.label,{style:a.labelStyle,useHtmlLabels:i,addSvgBackground:!0},e):t(a.label,a.labelStyle),p=r.insert("g").attr("class","edgeLabel"),h=p.insert("g").attr("class","label");h.node().appendChild(s);let c,g=s.getBBox();if(i){let t=s.children[0],r=o(s);g=t.getBoundingClientRect(),r.attr("width",g.width),r.attr("height",g.height)}if(h.attr("transform","translate("+-g.width/2+", "+-g.height/2+")"),b[a.id]=p,a.width=g.width,a.height=g.height,a.startLabelLeft){let e=t(a.startLabelLeft,a.labelStyle),i=r.insert("g").attr("class","edgeTerminals"),s=i.insert("g").attr("class","inner");c=s.node().appendChild(e);let n=e.getBBox();s.attr("transform","translate("+-n.width/2+", "+-n.height/2+")"),x[a.id]||(x[a.id]={}),x[a.id].startLeft=i,w(c,a.startLabelLeft)}if(a.startLabelRight){let e=t(a.startLabelRight,a.labelStyle),i=r.insert("g").attr("class","edgeTerminals"),s=i.insert("g").attr("class","inner");c=i.node().appendChild(e),s.node().appendChild(e);let n=e.getBBox();s.attr("transform","translate("+-n.width/2+", "+-n.height/2+")"),x[a.id]||(x[a.id]={}),x[a.id].startRight=i,w(c,a.startLabelRight)}if(a.endLabelLeft){let e=t(a.endLabelLeft,a.labelStyle),i=r.insert("g").attr("class","edgeTerminals"),s=i.insert("g").attr("class","inner");c=s.node().appendChild(e);let n=e.getBBox();s.attr("transform","translate("+-n.width/2+", "+-n.height/2+")"),i.node().appendChild(e),x[a.id]||(x[a.id]={}),x[a.id].endLeft=i,w(c,a.endLabelLeft)}if(a.endLabelRight){let e=t(a.endLabelRight,a.labelStyle),i=r.insert("g").attr("class","edgeTerminals"),s=i.insert("g").attr("class","inner");c=s.node().appendChild(e);let n=e.getBBox();s.attr("transform","translate("+-n.width/2+", "+-n.height/2+")"),i.node().appendChild(e),x[a.id]||(x[a.id]={}),x[a.id].endRight=i,w(c,a.endLabelRight)}return s},"insertEdgeLabel");function w(t,r){n().flowchart.htmlLabels&&t&&(t.style.width=9*r.length+"px",t.style.height="12px")}r(w,"setTerminalWidth");var M=r((t,r)=>{a.debug("Moving label abc88 ",t.id,t.label,b[t.id],r);let e=r.updatedPath?r.updatedPath:r.originalPath,i=n(),{subGraphTitleTotalMargin:s}=p(i);if(t.label){let i=b[t.id],n=t.x,d=t.y;if(e){let i=h.calcLabelPosition(e);a.debug("Moving label "+t.label+" from (",n,",",d,") to (",i.x,",",i.y,") abc88"),r.updatedPath&&(n=i.x,d=i.y)}i.attr("transform",`translate(${n}, ${d+s/2})`)}if(t.startLabelLeft){let r=x[t.id].startLeft,a=t.x,i=t.y;if(e){let r=h.calcTerminalLabelPosition(t.arrowTypeStart?10:0,"start_left",e);a=r.x,i=r.y}r.attr("transform",`translate(${a}, ${i})`)}if(t.startLabelRight){let r=x[t.id].startRight,a=t.x,i=t.y;if(e){let r=h.calcTerminalLabelPosition(t.arrowTypeStart?10:0,"start_right",e);a=r.x,i=r.y}r.attr("transform",`translate(${a}, ${i})`)}if(t.endLabelLeft){let r=x[t.id].endLeft,a=t.x,i=t.y;if(e){let r=h.calcTerminalLabelPosition(t.arrowTypeEnd?10:0,"end_left",e);a=r.x,i=r.y}r.attr("transform",`translate(${a}, ${i})`)}if(t.endLabelRight){let r=x[t.id].endRight,a=t.x,i=t.y;if(e){let r=h.calcTerminalLabelPosition(t.arrowTypeEnd?10:0,"end_right",e);a=r.x,i=r.y}r.attr("transform",`translate(${a}, ${i})`)}},"positionEdgeLabel"),$=r((t,r)=>{let a=t.x,e=t.y,i=Math.abs(r.x-a),s=Math.abs(r.y-e),n=t.width/2,d=t.height/2;return i>=n||s>=d},"outsideNode"),S=r((t,r,e)=>{a.debug(`intersection calc abc89:\n  outsidePoint: ${JSON.stringify(r)}\n  insidePoint : ${JSON.stringify(e)}\n  node        : x:${t.x} y:${t.y} w:${t.width} h:${t.height}`);let i=t.x,s=t.y,n=Math.abs(i-e.x),d=t.width/2,l=e.x<r.x?d-n:d+n,o=t.height/2,p=Math.abs(r.y-e.y),h=Math.abs(r.x-e.x);if(Math.abs(s-r.y)*d>Math.abs(i-r.x)*o){let t=e.y<r.y?r.y-o-s:s-o-r.y;l=h*t/p;let i={x:e.x<r.x?e.x+l:e.x-h+l,y:e.y<r.y?e.y+p-t:e.y-p+t};return 0===l&&(i.x=r.x,i.y=r.y),0===h&&(i.x=r.x),0===p&&(i.y=r.y),a.debug(`abc89 topp/bott calc, Q ${p}, q ${t}, R ${h}, r ${l}`,i),i}{l=e.x<r.x?r.x-d-i:i-d-r.x;let t=p*l/h,s=e.x<r.x?e.x+h-l:e.x-h+l,n=e.y<r.y?e.y+t:e.y-t;return a.debug(`sides calc abc89, Q ${p}, q ${t}, R ${h}, r ${l}`,{_x:s,_y:n}),0===l&&(s=r.x,n=r.y),0===h&&(s=r.x),0===p&&(n=r.y),{x:s,y:n}}},"intersection"),_=r((t,r)=>{a.debug("abc88 cutPathAtIntersect",t,r);let e=[],i=t[0],s=!1;return t.forEach(t=>{if($(r,t)||s)i=t,s||e.push(t);else{let a=S(r,i,t),n=!1;e.forEach(t=>{n=n||t.x===a.x&&t.y===a.y}),e.some(t=>t.x===a.x&&t.y===a.y)||e.push(a),s=!0}}),e},"cutPathAtIntersect"),E=r(function(t,r,d,l,o,p,h){let c=d.points;a.debug("abc88 InsertEdge: edge=",d,"e=",r);let g=!1,m=p.node(r.v);var f=p.node(r.w);f?.intersect&&m?.intersect&&(c=c.slice(1,d.points.length-1),c.unshift(m.intersect(c[0])),c.push(f.intersect(c[c.length-1]))),d.toCluster&&(a.debug("to cluster abc88",l[d.toCluster]),c=_(d.points,l[d.toCluster].node),g=!0),d.fromCluster&&(a.debug("from cluster abc88",l[d.fromCluster]),c=_(c.reverse(),l[d.fromCluster].node).reverse(),g=!0);let y=c.filter(t=>!Number.isNaN(t.y)),b=s;d.curve&&("graph"===o||"flowchart"===o)&&(b=d.curve);let x,{x:u,y:L}=e(d),w=i().x(u).y(L).curve(b);switch(d.thickness){case"normal":x="edge-thickness-normal";break;case"thick":case"invisible":x="edge-thickness-thick";break;default:x=""}switch(d.pattern){case"solid":x+=" edge-pattern-solid";break;case"dotted":x+=" edge-pattern-dotted";break;case"dashed":x+=" edge-pattern-dashed"}let M=t.append("path").attr("d",w(y)).attr("id",d.id).attr("class"," "+x+(d.classes?" "+d.classes:"")).attr("style",d.style),$="";(n().flowchart.arrowMarkerAbsolute||n().state.arrowMarkerAbsolute)&&($=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,$=$.replace(/\(/g,"\\("),$=$.replace(/\)/g,"\\)")),k(M,d,$,h,o);let S={};return g&&(S.updatedPath=c),S.originalPath=d.points,S},"insertEdge");export{E as L,u as b,m as t,L as x,M as y};
//# sourceMappingURL=chunk-2RSIMOBZ-wXtHrv7p.js.map
