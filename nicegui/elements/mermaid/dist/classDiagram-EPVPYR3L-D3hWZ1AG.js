import{o as t,a as e,j as a}from"./chunk-YJEQJWB7-D0AaQXLJ.js";import{s as r}from"./chunk-BOP2KBYH-DSA32-lu.js";import{b as i}from"./chunk-6XGRHI2A-CSmXlrJf.js";import{m as n,Q as d,J as o,f as s,k as l,g as p,h as g,I as h,i as c}from"./index-Dne072Ek.js";import"./chunk-BKDDFIKN-CmrN6bhn.js";var f=0,x=n(function(t,e,a,r,i){let d=n(function(t){switch(t){case i.db.relationType.AGGREGATION:return"aggregation";case i.db.relationType.EXTENSION:return"extension";case i.db.relationType.COMPOSITION:return"composition";case i.db.relationType.DEPENDENCY:return"dependency";case i.db.relationType.LOLLIPOP:return"lollipop"}},"getRelationType");e.points=e.points.filter(t=>!Number.isNaN(t.y));let s=e.points,l=p().x(function(t){return t.x}).y(function(t){return t.y}).curve(g),c=t.append("path").attr("d",l(s)).attr("id","edge"+f).attr("class","relation"),x="";r.arrowMarkerAbsolute&&(x=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,x=x.replace(/\(/g,"\\("),x=x.replace(/\)/g,"\\)")),1==a.relation.lineType&&c.attr("class","relation dashed-line"),10==a.relation.lineType&&c.attr("class","relation dotted-line"),"none"!==a.relation.type1&&c.attr("marker-start","url("+x+"#"+d(a.relation.type1)+"Start)"),"none"!==a.relation.type2&&c.attr("marker-end","url("+x+"#"+d(a.relation.type2)+"End)");let y,u,m,w,k,b,E=e.points.length,L=h.calcLabelPosition(e.points);if(y=L.x,u=L.y,E%2!=0&&E>1){let t=h.calcCardinalityPosition("none"!==a.relation.type1,e.points,e.points[0]),r=h.calcCardinalityPosition("none"!==a.relation.type2,e.points,e.points[E-1]);o.debug("cardinality_1_point "+JSON.stringify(t)),o.debug("cardinality_2_point "+JSON.stringify(r)),m=t.x,w=t.y,k=r.x,b=r.y}if(void 0!==a.title){let e=t.append("g").attr("class","classLabel"),i=e.append("text").attr("class","label").attr("x",y).attr("y",u).attr("fill","red").attr("text-anchor","middle").text(a.title);window.label=i;let n=i.node().getBBox();e.insert("rect",":first-child").attr("class","box").attr("x",n.x-r.padding/2).attr("y",n.y-r.padding/2).attr("width",n.width+r.padding).attr("height",n.height+r.padding)}o.info("Rendering relation "+JSON.stringify(a)),void 0!==a.relationTitle1&&"none"!==a.relationTitle1&&t.append("g").attr("class","cardinality").append("text").attr("class","type1").attr("x",m).attr("y",w).attr("fill","black").attr("font-size","6").text(a.relationTitle1),void 0!==a.relationTitle2&&"none"!==a.relationTitle2&&t.append("g").attr("class","cardinality").append("text").attr("class","type2").attr("x",k).attr("y",b).attr("fill","black").attr("font-size","6").text(a.relationTitle2),f++},"drawEdge"),y=n(function(t,e,a,r){o.debug("Rendering class ",e,a);let i,n=e.id,d={id:n,label:e.id,width:0,height:0},s=t.append("g").attr("id",r.db.lookUpDomId(n)).attr("class","classGroup");i=e.link?s.append("svg:a").attr("xlink:href",e.link).attr("target",e.linkTarget).append("text").attr("y",a.textHeight+a.padding).attr("x",0):s.append("text").attr("y",a.textHeight+a.padding).attr("x",0);let l=!0;e.annotations.forEach(function(t){let e=i.append("tspan").text("«"+t+"»");l||e.attr("dy",a.textHeight),l=!1});let p=u(e),g=i.append("tspan").text(p).attr("class","title");l||g.attr("dy",a.textHeight);let h,c,f,x=i.node().getBBox().height;if(e.members.length>0){h=s.append("line").attr("x1",0).attr("y1",a.padding+x+a.dividerMargin/2).attr("y2",a.padding+x+a.dividerMargin/2);let t=s.append("text").attr("x",a.padding).attr("y",x+a.dividerMargin+a.textHeight).attr("fill","white").attr("class","classText");l=!0,e.members.forEach(function(e){w(t,e,l,a),l=!1}),c=t.node().getBBox()}if(e.methods.length>0){f=s.append("line").attr("x1",0).attr("y1",a.padding+x+a.dividerMargin+c.height).attr("y2",a.padding+x+a.dividerMargin+c.height);let t=s.append("text").attr("x",a.padding).attr("y",x+2*a.dividerMargin+c.height+a.textHeight).attr("fill","white").attr("class","classText");l=!0,e.methods.forEach(function(e){w(t,e,l,a),l=!1})}let y=s.node().getBBox();var m=" ";e.cssClasses.length>0&&(m+=e.cssClasses.join(" "));let k=s.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",y.width+2*a.padding).attr("height",y.height+a.padding+.5*a.dividerMargin).attr("class",m).node().getBBox().width;return i.node().childNodes.forEach(function(t){t.setAttribute("x",(k-t.getBBox().width)/2)}),e.tooltip&&i.insert("title").text(e.tooltip),h&&h.attr("x2",k),f&&f.attr("x2",k),d.width=k,d.height=y.height+a.padding+.5*a.dividerMargin,d},"drawClass"),u=n(function(t){let e=t.id;return t.type&&(e+="<"+c(t.type)+">"),e},"getClassTitleString"),m=n(function(t,e,a,r){o.debug("Rendering note ",e,a);let i=e.id,n={id:i,text:e.text,width:0,height:0},d=t.append("g").attr("id",i).attr("class","classGroup"),s=d.append("text").attr("y",a.textHeight+a.padding).attr("x",0),l=JSON.parse(`"${e.text}"`).split("\n");l.forEach(function(t){o.debug(`Adding line: ${t}`),s.append("tspan").text(t).attr("class","title").attr("dy",a.textHeight)});let p=d.node().getBBox(),g=d.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",p.width+2*a.padding).attr("height",p.height+l.length*a.textHeight+a.padding+.5*a.dividerMargin).node().getBBox().width;return s.node().childNodes.forEach(function(t){t.setAttribute("x",(g-t.getBBox().width)/2)}),n.width=g,n.height=p.height+l.length*a.textHeight+a.padding+.5*a.dividerMargin,n},"drawNote"),w=n(function(t,e,a,r){let{displayText:i,cssStyle:n}=e.getDisplayDetails(),d=t.append("tspan").attr("x",r.padding).text(i);""!==n&&d.attr("style",e.cssStyle),a||d.attr("dy",r.textHeight)},"addTspan"),k={getClassTitleString:u,drawClass:y,drawEdge:x,drawNote:m},b={},E=n(function(t){let e=Object.entries(b).find(e=>e[1].label===t);if(e)return e[0]},"getGraphId"),L=n(function(t){t.append("defs").append("marker").attr("id","extensionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),t.append("defs").append("marker").attr("id","extensionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z"),t.append("defs").append("marker").attr("id","compositionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","compositionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),N=n(function(t,e,a,n){let p=d().class;b={},o.info("Rendering diagram "+t);let g,h=d().securityLevel;"sandbox"===h&&(g=s("#i"+e));let c=s("sandbox"===h?g.nodes()[0].contentDocument.body:"body"),f=c.select(`[id='${e}']`);L(f);let x=new i({multigraph:!0});x.setGraph({isMultiGraph:!0}),x.setDefaultEdgeLabel(function(){return{}});let y=n.db.getClasses(),u=[...y.keys()];for(let t of u){let e=y.get(t),a=k.drawClass(f,e,p,n);b[a.id]=a,x.setNode(a.id,a),o.info("Org height: "+a.height)}n.db.getRelations().forEach(function(t){o.info("tjoho"+E(t.id1)+E(t.id2)+JSON.stringify(t)),x.setEdge(E(t.id1),E(t.id2),{relation:t},t.title||"DEFAULT")}),n.db.getNotes().forEach(function(t){o.debug(`Adding note: ${JSON.stringify(t)}`);let e=k.drawNote(f,t,p,n);b[e.id]=e,x.setNode(e.id,e),t.class&&y.has(t.class)&&x.setEdge(t.id,E(t.class),{relation:{id1:t.id,id2:t.class,relation:{type1:"none",type2:"none",lineType:10}}},"DEFAULT")}),r(x),x.nodes().forEach(function(t){void 0!==t&&void 0!==x.node(t)&&(o.debug("Node "+t+": "+JSON.stringify(x.node(t))),c.select("#"+(n.db.lookUpDomId(t)||t)).attr("transform","translate("+(x.node(t).x-x.node(t).width/2)+","+(x.node(t).y-x.node(t).height/2)+" )"))}),x.edges().forEach(function(t){void 0!==t&&void 0!==x.edge(t)&&(o.debug("Edge "+t.v+" -> "+t.w+": "+JSON.stringify(x.edge(t))),k.drawEdge(f,x.edge(t),x.edge(t).relation,p,n))});let m=f.node().getBBox(),w=m.width+40,N=m.height+40;l(f,N,w,p.useMaxWidth);let T=`${m.x-20} ${m.y-20} ${w} ${N}`;o.debug(`viewBox ${T}`),f.attr("viewBox",T)},"draw"),T={parser:a,db:e,renderer:{draw:N},styles:t,init:n(t=>{t.class||(t.class={}),t.class.arrowMarkerAbsolute=t.arrowMarkerAbsolute,e.clear()},"init")};export{T as diagram};
