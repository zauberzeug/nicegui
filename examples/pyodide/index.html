<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NiceGUI Pyodide Demo</title>

    <!-- CSS with layer ordering (must match server-side index.html cascade) -->
    <style>
        @layer theme, base, quasar, nicegui, components, utilities, overrides, quasar_importants;
        @import url("fonts.css") layer(base);
        @import url("quasar.unimportant.prod.css") layer(quasar);
        @import url("quasar.important.prod.css") layer(quasar_importants);
        @import url("nicegui.css") layer(nicegui);
        @layer quasar {
            blockquote, dd, dl, figure, h1, h2, h3, h4, h5, h6, hr, p, pre {
                margin: revert-layer; /* HACK: revert Quasar's margin styles */
            }
        }
        @layer overrides {
            .rotate-45, .rotate-90, .rotate-135, .rotate-180, .rotate-225, .rotate-270, .rotate-315 {
                rotate: 0deg;
            }
            .column.inline, .flex.inline, .row.inline {
                display: inline-flex; /* HACK: re-apply Quasar's inline styles to override Tailwind */
            }
            .nicegui-dialog-open,
            .nicegui-select-popup-open {
                scroll-behavior: auto !important; /* HACK: avoid smooth-scrolling when dialogs or select popups close */
            }
        }
        #loading { padding: 2em; font-family: sans-serif; color: #666; }
    </style>
    <script src="tailwindcss.min.js"></script>

    <!-- BEGIN IMPORTMAP (generated by prepare.py â€” do not edit manually) -->
    <script type="importmap">
{
  "imports": {
    "nicegui-aggrid": "./esm/nicegui-aggrid/index.js",
    "nicegui-aggrid/": "./esm/nicegui-aggrid/",
    "nicegui-codemirror": "./esm/nicegui-codemirror/index.js",
    "nicegui-codemirror/": "./esm/nicegui-codemirror/",
    "nicegui-echart": "./esm/nicegui-echart/index.js",
    "nicegui-echart/": "./esm/nicegui-echart/",
    "nicegui-joystick": "./esm/nicegui-joystick/index.js",
    "nicegui-joystick/": "./esm/nicegui-joystick/",
    "nicegui-json-editor": "./esm/nicegui-json-editor/index.js",
    "nicegui-json-editor/": "./esm/nicegui-json-editor/",
    "nicegui-leaflet": "./esm/nicegui-leaflet/index.js",
    "nicegui-leaflet/": "./esm/nicegui-leaflet/",
    "nicegui-mermaid": "./esm/nicegui-mermaid/index.js",
    "nicegui-mermaid/": "./esm/nicegui-mermaid/",
    "nicegui-plotly": "./esm/nicegui-plotly/index.js",
    "nicegui-plotly/": "./esm/nicegui-plotly/",
    "nicegui-scene": "./esm/nicegui-scene/index.js",
    "nicegui-scene/": "./esm/nicegui-scene/",
    "nicegui-xterm": "./esm/nicegui-xterm/index.js",
    "nicegui-xterm/": "./esm/nicegui-xterm/",
    "dompurify": "./static/dompurify.mjs"
  }
}
    </script>
    <!-- END IMPORTMAP -->
</head>
<body>
    <div id="loading">Loading Pyodide and NiceGUI...</div>
    <div id="app"></div>

    <!-- Vendor JS (run prepare.py to create these files) -->
    <script type="module">
        import * as Vue from './vue.esm-browser.prod.js';
        window.Vue = Vue;
    </script>
    <script defer src="quasar.umd.prod.js"></script>

    <!-- Set up bridge BEFORE loading nicegui.js so it detects Pyodide mode -->
    <script>
        window.niceguiBridge = {
            handleMessage: function(type, dataJson) {
                console.log('Bridge received (pre-init):', type);
            },
            onEvent: null,
            onJavascriptResponse: null,
        };
    </script>

    <!-- setHTML polyfill: provides Element.prototype.setHTML using DOMPurify -->
    <script type="module">
        if (!Element.prototype.setHTML) {
            const { default: DOMPurify } = await import('./static/dompurify.mjs');
            Element.prototype.setHTML = function(html) {
                this.innerHTML = DOMPurify.sanitize(html);
            };
        }
    </script>

    <!-- NiceGUI JS (run prepare.py to create these files) -->
    <script defer src="nicegui.js"></script>

    <!-- PyScript -->
    <script type="module" src="https://pyscript.net/releases/2026.2.1/core.js"></script>
    <script type="py" src="entrypoint.py" config="pyscript.toml"></script>
</body>
</html>
